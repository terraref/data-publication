## Sensor Data {#sensor-data}

### Field Scanner Sensors {#field-scanner-sensors}

This publication includes the following data generated by sensors. Detailed sensor and system details can be found in the file `metadata/sensors_information.zip` as well as browsed online through the Clowder Interface [terraref.org/clowder](https://terraref.ncsa.illinois.edu/clowder/datasets?space=594bda394f0cf8bbab271dfb&size=24#) in a space named "Maricopa Agricultural Center Device and Sensor Information".

The sensor information folder contains extensive documentation for each of the sensors, the field scanner, calibration targets, and the results of sensor validation tests.

Additional sensors not represented in this version of the data are listed in the section on sensors in the section on [additional sensors](#future-sensors).


| Sensor Name | Model | Technical Specifications |
| :--- | :--- | :--- |
| **Imaging Sensors** |  |  |  
| Stereo RGB Camera  |  Allied Vision Prosilica GT3300C  |  | 
| Laser Scanner | [Custom Fraunhofer 3D](https://terraref.ncsa.illinois.edu/clowder/datasets/5873a7444f0cad7d81319b2b?space=594bda394f0cf8bbab271dfb)) | Resolution: 0.3-0.9 mm | 
| Thermal Infrared | [FLIR A615](https://terraref.ncsa.illinois.edu/clowder/datasets/5873a7184f0cad7d8131994a)) |  Thermal Sensitivity &lt; 50mK @ 30&deg;C  | 
| PS II Camera | [LemnaTec PS II Fluorescence Prototype](https://terraref.ncsa.illinois.edu/clowder/datasets/5873a84b4f0cad7d8131a73d)) | Illumination 635nm x 4000 &mu;mol/m^2^/s, Camera 50 fps | 
| **Environmental Sensors** |  |  |  |
| Environmental Sensors | [Thies Clima 4.9200.00.000](https://terraref.ncsa.illinois.edu/clowder/datasets/5873a9724f0cad7d8131b4d3)) |  |  Wind, Air Temperature, Humidity, Pressure, Light, Precipitation | 
| VNIR Spectrometer  | [Spectral Evolution PSR+3500](https://terraref.ncsa.illinois.edu/clowder/datasets/599deaa64f0c19c55fc0aecd)  | Range 350 to 800 nm| 
<<<<<<< HEAD
| Environmental Sensors | [Thies Clima 4.9200.00.000](https://terraref.ncsa.illinois.edu/clowder/datasets/5873a9724f0cad7d8131b4d3)) |  |  Wind, Air Temperature, Humidity, Pressure, Light, Precipitation | 
| VNIR Spectrometer  | [Spectral Evolution PSR+3500](https://terraref.ncsa.illinois.edu/clowder/datasets/599deaa64f0c19c55fc0aecd)  | Range 350 to 800 nm| 
=======
>>>>>>> bc4c24d563a5e5181f1b7055b80a0b589c26cf6b
| PAR Sensor | Quantum SQ-300 |  Spectral Range 410 to 655 nm |

### Sensor Data Products


The total size of raw (Level 0) data generated by these sensors is 60 TB. The Level 1 and Level 2 sensor data products are 490 TB. This size could be substantially reduced through compression and removal of duplicate data (for example, the same images at the same resolution appear in the georeferenced Level 1 files, the full field mosaics, and the plot level clip).

These are stored on the Storage Condo at the National Center for Supercomputing Applications in Urbana, IL. We make them available for download with the Globus file transfer system: 1) get an account at [globus.org](https://www.globus.org/); 2) search for the `terra-public` endpoint; 3) the data can be transferred using the [Globus Personal Connect application](https://www.globus.org/globus-connect-personal). Further information is provided in the data access chapter of the [TERRA REF documentation](https://docs.terraref.org/user-manual/how-to-access-data). Alternatively, data sharing via a hard drive can be arranged for the costs of supplies and labor.

#### Sensor Data Catalog

Globus provides the easiest way to navigate the data. This archive also contains a catalog listing all of the files in the dataset. The catalog is one compressed `.zip` file per season, currently Seasons 4 and 6, found in the `data/` directory in files named `season_[n]_catalog.zip`. The compressed catalogs are 373 MB, and expand to 5.4 GB when uncompressed. After uncompressing the catalog files, the catalog contains one directory per data product and one file per day named `[data product]/file_catalog_season[n]_[data product]_[filetype]_YYYY-MM-DD.json`.

These catalog files contain the following information in JSON format:

```yaml
collections: 'collection name [Data Product Name] - YYYY-MM'
    datasets: 'dataset name [Data Product Name] - [YYYY-MM-DD]'
        files:
            path: 'season-[n]/sites/ua-mac/Level_[m]/[data_product]/[filename]'
            checksum: '[checksum_string]'
            name: '[data product]_L[m]_[YYYY-MM-DD]_[Scan Name]'
            size: 'bytes'
```

There is one collection per data product per month, and one dataset per data product per day. This structure and naming maps to Collections and Datasets in the Clowder database and web interface [see data access documentation](https://docs.terraref.org/user-manual/how-to-access-data).

Below is a summary of the sensor data products included in this release. Sensor-derived [Phenotypes] were generated from the 3D laser scanner and RGB camera sensors as described in the [Methods] section.

| Data Product    | Sensor                | Algorithm     | File Format | Plot Clip | Full Field |
|-----------------|-----------------------|---------------|-------------|-----------|------------|
| Environment  | Thies Clima           | envlog2netcdf | netcdf      | NA        | NA         |
| Thermal Image      | FLIR                  | ir_geotiff    | geotiff     | +         |            |
| Point Cloud | Fraunhofer Laser 3D | laser3d_las   | las         | +         |            |
| Point Cloud | Fraunhofer Laser 3D | scanner3DTop  | ply         |           |            |
| Images Time-Series  | PSII Camera           | ps2png        | png         |           |            |
| Color Images    | RGB Stereo            | bin2tiff      | geotiff     | +         | +          |
| Plant Mask            | RGB Stereo            | rgb_mask      | geotiff     |          | x           |

```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
sensors <- readr::read_csv('metadata/sensor_products.csv', skip = 1,
                           col_names = c("season", "date", "RGB", "RGB Mask", "RGB Plots", "RGB Full Field", "Mask Full Field", "Thermal Image", "Thermal Image Plots", "Point Cloud ply", "Point Cloud LAS", "Point Cloud Plots", "PSII", "Environmental Logger"),
                          col_types = list(col_integer(), col_date(format = "%D"), col_integer(), col_integer(), col_integer(), col_integer(), col_integer(), col_integer(), col_integer(), col_integer(), col_integer(), col_integer(), col_integer(), col_integer()))
sensors_long <- sensors %>%
  pivot_longer(cols = `RGB`:`Environmental Logger`) %>%
  mutate(#value = ifelse(value == 0, NA, value),
         season = paste("Season", season))

# dummy rows to get equal date axes
sensors_long <- sensors_long %>%
  #rbind(
  #data.frame(season = c("Season 4", "Season 4", "Season 6", "Season 6"),
  #           date = lubridate::ymd(c('2017-04-01', '2017-09-30', '2018-04-01', '2018-09-30')),
  #           name = "RGB", value = 0)) %>%
  mutate(value = ifelse(value == 0, NA, value))


```


Figure \@ref(fig:sensor-file-counts) shows the number of files for each data type across seasons 4 and 6.

```{r sensor-file-counts, include = TRUE, warning=FALSE, fig.cap='counts of individual files for each type of sensor data product', fig.height=8}

ggplot(data = sensors_long) +
  geom_point(aes(date, name, size = value)) +
  scale_x_date(date_labels = '%b %Y') +
  scale_size_area(trans = 'log10', max_size = 1)+#, breaks = 10^(0:4))
  facet_wrap(~season, scales = 'free', ncol = 1) +
  ylab("Data Product") +
  xlab("Date") +
 # ggthemes::theme_tufte() +
  theme_minimal() +
  theme(legend.position = "bottom")
```

#### Globus Directory Contents

* **Environment Logger**
  * envlog_netcdf
    * Daily aggregated files named `envlog_netcdf_L1_ua-mac_YYYY-MM-DD.nc`.
    * There are also 24 hourly files for each day named `YYYY-MM-DD_HH-MM-SS_environmentlogger.nc`.
* **Laser3D**
  * laser3d_las
    * One merged file per scan across the short (E-W) axis ending in `_merged.las`. There can be 50-100 of these each day.
  * laser3d_las_plot
    * Each directory has the name of one plot, and there is one `.las` file clipped to the plot boundaries for each scan (there may be more than one scan per day).
* **RGB Stereo**:
  * rgb_geotiff
    * File names ending in `_left.tif` and `_right.tif` represent simultaneous images from left and right stereo pair cameras.
  * rgb_mask
    * For each `_left_mask.tif` in the rgb_geotiff dataset, an image with black pixels representing pixels that contain soil and not plant.
  * rgb_geotiff_plots
    * For each image in the rgb_geotiff dataset, a geotiff file with the same dimensions as the plot. It contains the image clipped to the plot boundaries as well as fill values for parts of the plot not in the image.
  * rgb_fullfield
    * Key data product is full resolution full-field image.
    * Other files include: lower resolution versions of the full field (`_10pct.tif`, `_thumb.tif` and `.png`; `.csv` files containing canopy cover values for each plot, `.json` file listing images contained in the fullfield mosaic and `.vrt` is a 'virtual geotiff' that is used to generate the full-field mosaic.
    * These are RGB images and image masks tiled together to make up a full-field view. These full-fields are _not_ orthomosaics because they are not stitched together because this causes geometric aberrations.
* **PSII Camera**:
  * ps2_png:
    * 101 `.png` files per folder. The order of the images is indicated by the last four digits of the file name, i.e. `_0000.png` to `_0100.png`.
    * 101 georeferenced `.tif` files otherwise identical to the png counterparts.
    * These represent a time series of images captured at a rate of 50 frames per second.

#### Directory Structure and File Naming

**File Names**

**Structure**: under the directory season_[4,6]/sites/ua-mac

```
|-Level
|  |- Data product name
|  |  |-Date (YYYY-MM-DD)
|  |  |  |-Date-Time (YYYY-MM-DD__HH-MM-SS-SSS, optional)
|  |  |  |  |- File name(s)
```
e.g.

```
|-Level_1
|  |- envlog_netcdf
|  |  |-2017-08-26
|  |  |  |- YYYY-MM-DD_HH-MM-SS-SSS_environmentlogger.nc
|  |- laser3d_las
|  |  |-YYYY-MM-DD
|  |  |  |-YYYY-MM-DD__HH-MM-SS-SSS
|  |  |  |  |- scanner3DTop - YYYY-MM-DD__HH-MM-SS-SSS MergedPointCloud.las
```

For convenience, we have pre-processed some images and point clouds to plot boundaries and have organized them by Date and then Plot name, e.g.:  

```
|-Level_1_plots
|  |- rgb_geotiff
|  |  |- 2017-04-26
|  |  |  |- MAC Field Scanner Season 4 Range 21 Column 16
|  |  |  |  |- rgb_geotiff_L1_ua-mac_2017-04-26__12-56-14-907_right.tif
|  |  |  |  |- rgb_geotiff_L1_ua-mac_2017-04-26__12-56-14-907_left.tif
|  |  |  |  |- rgb_geotiff_L1_ua-mac_2017-04-26__12-53-34-106_right.tif
```



```
|-Level_2
|  |- rgb_fullfield
|  |  |-YYYY-MM-DD
```
